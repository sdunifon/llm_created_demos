<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Space Block Defense</title>
<style>
body{margin:0;background:#000;color:#fff;font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;touch-action:none}#g{position:relative;width:300px;height:600px}canvas{border:2px solid #4CAF50;box-shadow:0 0 10px #4CAF50}#i,#k{position:absolute;left:10px;font-size:12px;background:rgba(0,0,0,.7);padding:5px}#i{top:10px}#k{top:40px;cursor:pointer}#kd{display:none;margin-top:5px}.n{position:absolute;width:30px;height:30px;filter:drop-shadow(0 0 5px #ff0)}.b{position:absolute;width:5px;height:5px;background:#ff0;border-radius:50%;box-shadow:0 0 5px #ff0}#s,#o{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background:rgba(0,0,0,.8)}button{padding:10px 20px;font-size:18px;background:#4CAF50;color:#fff;border:none;border-radius:5px;cursor:pointer}button:hover{background:#45a049}#m{display:none;position:absolute;bottom:10px;left:0;right:0;justify-content:space-around}.mb{width:50px;height:50px;background:rgba(255,255,255,.2);border-radius:25px;display:flex;justify-content:center;align-items:center;font-size:24px;user-select:none;transition:background-color .1s}.mb:active{background:rgba(255,255,255,.4)}@media (max-width:600px){#g{transform:scale(.8);transform-origin:top center}#m{display:flex}}
</style>
</head>
<body>
<div id="g">
<canvas id="a" width="300" height="600"></canvas>
<div id="i">Level: <span id="l">1</span> | Score: <span id="r">0</span></div>
<div id="k">Controls ▼<div id="kd">A/D: Move<br>W: Slow<br>S: Fast<br>Q/E: Rotate</div></div>
<div id="s"><h1>Space Block Defense</h1><p>Defend your space station!</p><button id="b">Start Game</button></div>
<div id="o" style="display:none"><h1>Game Over</h1><p>Score: <span id="f"></span></p><button id="t">Play Again</button></div>
<div id="m"><div class="mb" id="ml">⬅️</div><div class="mb" id="mr">➡️</div><div class="mb" id="md">⬇️</div><div class="mb" id="mrl">↪️</div><div class="mb" id="mrr">↩️</div></div>
</div>
<script>
const a=document.getElementById('a'),x=a.getContext('2d'),h=30,w=a.width/h,v=a.height/h,d=['#4CAF50','#FFEB3B','#FF9800','#F44336'],p=[[[1,1,1,1]],[[1,1],[1,1]],[[1,1,1],[0,1,0]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]],e=['#FF0000','#00FF00','#0000FF','#FFFF00','#FF00FF','#00FFFF'];let b,c,g,s,l,u,m,B,t,y,n,q,z,L,T;function P(){const R=p[Math.floor(Math.random()*p.length)];return{S:R.map(r=>r.map(C=>C?{v:C,d:0}:0)),x:Math.floor(w/2)-Math.floor(R[0].length/2),y:0}}function D(){x.clearRect(0,0,a.width,a.height);b.forEach((r,y)=>r.forEach((C,j)=>{if(C){x.fillStyle=d[Math.min(Math.floor(C.d),3)];x.fillRect(j*h,y*h,h-1,h-1);x.strokeStyle='#fff';x.strokeRect(j*h,y*h,h-1,h-1)}}));c&&c.S&&c.S.forEach((r,y)=>r.forEach((C,j)=>{if(C){x.fillStyle=d[Math.min(Math.floor(C.d),3)];x.fillRect((c.x+j)*h,(c.y+y)*h,h-1,h-1);x.strokeStyle='#fff';x.strokeRect((c.x+j)*h,(c.y+y)*h,h-1,h-1)}}));q.forEach(S=>S.forEach(p=>{x.fillStyle=`rgba(255,255,255,${p.l})`;x.fillRect(p.x,p.y,2,2)}))}function E(){return c&&c.S&&c.S.some((r,y)=>r.some((C,j)=>C&&(c.x+j<0||c.x+j>=w||c.y+y>=v||(c.y+y>=0&&b[c.y+y]&&b[c.y+y][c.x+j]))))}function M(){c&&c.S&&c.S.forEach((r,y)=>r.forEach((C,j)=>{if(C&&b[c.y+y])b[c.y+y][c.x+j]=C}))}function C(){let E=0;for(let y=v-1;y>=0;y--)if(b[y]&&b[y].every(C=>C)){b.splice(y,1);b.unshift(Array(w).fill(0));E++;q.push(Array(20).fill().map(()=>({x:Math.random()*a.width,y:y*h+Math.random()*20,vx:(Math.random()-.5)*5,vy:(Math.random()-.5)*5,l:1})))}if(E>0){s+=E*E*100*l;L+=E;document.getElementById('r').textContent=s;if(L>=5){L-=5;B=Math.max(100,B-10);l++;document.getElementById('l').textContent=l}}}function N(S,O){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("class","n");n.setAttribute("viewBox","0 0 100 100");const R=1+Math.random()*2,I=Math.floor(R*2)-2;n.innerHTML=`<polygon points="50,0 0,100 100,100" fill="${e[I]}" /><circle cx="50" cy="60" r="20" fill="#f00" />`;n.style[S]="-30px";document.getElementById("g").appendChild(n);return{e:n,s:S,o:O,l:0,i:1e3+Math.random()*1e3,R}}function F(n){const b=document.createElement("div");b.className="b";const G=n.e.getBoundingClientRect(),H=document.getElementById("g").getBoundingClientRect();b.style.top=`${G.top-H.top+15}px`;b.style[n.s]="0px";document.getElementById("g").appendChild(b);y.push({e:b,s:n.s,p:0,y:(G.top-H.top+15)/h})}function U(Z){n.forEach(n=>{n.e.style.top=`${Math.sin(Z/1e3*n.R+n.o)*(a.height/2-45)+(a.height/2-45)}px`;n.l+=16;if(n.l>=n.i){F(n);n.l=0;n.i=500+Math.random()*500}});y=y.filter(b=>{b.p+=5;b.e.style[b.s]=`${b.p}px`;const X=b.s==="left"?b.p/h:(a.width-b.p)/h,Y=b.y;let J=!1;if(c&&c.S)c.S.forEach((r,y)=>r.forEach((C,j)=>{if(C&&Math.abs(c.x+j-X)<.5&&Math.abs(c.y+y-Y)<.5){C.d++;if(C.d>=3){c.S[y][j]=0;q.push(Array(10).fill().map(()=>({x:(c.x+j)*h+Math.random()*10,y:(c.y+y)*h+Math.random()*10,vx:(Math.random()-.5)*5,vy:(Math.random()-.5)*5,l:1})))}J=!0}}));const W=Math.floor(X),V=Math.floor(Y);if(V>=0&&V<v&&W>=0&&W<w&&b[V]&&b[V][W]){b[V][W].d+=.25;if(b[V][W].d>=3){b[V][W]=0;q.push(Array(10).fill().map(()=>({x:W*h+Math.random()*10,y:V*h+Math.random()*10,vx:(Math.random()-.5)*5,vy:(Math.random()-.5)*5,l:1})))}J=!0}if(J||b.p>a.width||b.p<0){b.e.remove();return!1}return!0});q=q.filter(S=>{S.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.l-=.02});return S.some(p=>p.l>0)})}function A(Z=0){const I=Z-t;t=Z;u+=I;if(g){cancelAnimationFrame(z);document.getElementById('o').style.display='flex';document.getElementById('f').textContent=s;return}U(Z);if(u>m)Y();D();z=requestAnimationFrame(A)}function K(){b=Array(v).fill().map(()=>Array(w).fill(0));c=P();g=!1;s=0;l=1;u=0;B=1e3;m=B;t=0;y=[];n=[];q=[];L=0;for(let i=0;i<3;i++){n.push(N("left",i*Math.PI/3));n.push(N("right",i*Math.PI/3))}document.getElementById('s').style.display='none';document.getElementById('o').style.display='none';a.style.display='block';document.getElementById('m').style.display='flex';R();A()}function Y(){c.y++;if(E()){c.y--;M();C();c=P();if(E())g=!0;else{m=B;R()}}u=0}function R(){clearTimeout(T);T=setTimeout(()=>{if(!g)Y()},5e3)}function H(k){if(!c||g)return;if(k==='a'){c.x--;if(E())c.x++}else if(k==='d'){c.x++;if(E())c.x--}else if(k==='s')m=50;else if(k==='w')m=2e3;else if(k==='q'){const r=c.S[0].map((_,i)=>c.S.map(r=>r[r.length-1-i]));const o=c.S;c.S=r;if(E())c.S=o}else if(k==='e'){const r=c.S[0].map((_,i)=>c.S.map(r=>r[i]).reverse());const o=c.S;c.S=r;if(E())c.S=o}}document.addEventListener('keydown',e=>H(e.key.toLowerCase()));document.addEventListener('keyup',e=>{if(e.key.toLowerCase()==='s'||e.key.toLowerCase()==='w')m=B});document.getElementById('b').addEventListener('click',K);document.getElementById('t').addEventListener('click',K);['ml','mr','md','mrl','mrr'].forEach(id=>{const el=document.getElementById(id);let key;switch(id){case'ml':key='a';break;case'mr':key='d';break;case'md':key='s';break;case'mrl':key='q';break;case'mrr':key='e';break}el.addEventListener('touchstart',e=>{e.preventDefault();H(key);el.style.backgroundColor='rgba(255,255,255,0.4)'});el.addEventListener('touchend',e=>{e.preventDefault();if(key==='s')m=B;el.style.backgroundColor='rgba(255,255,255,0.2)'})});document.getElementById('k').addEventListener('click',()=>{const kd=document.getElementById('kd');kd.style.display=kd.style.display==='none'?'block':'none';document.getElementById('k').textContent=kd.style.display==='none'?'Controls ▼':'Controls ▲'});
</script>
</body>
</html>
